---
/**
 * Overview Section Component
 * 
 * Displays the main overview/introduction section of the website.
 * Provides a description of the trail and location information with map.
 * 
 * Props:
 * @param {string} title - Section title
 * @param {string} subtitle - Section subtitle
 * @param {string} description - Main description text
 * @param {string} mapTitle - Map section title
 * @param {string} getDirectionsText - Text for directions link
 * @param {string} getDirectionsUrl - URL for Google Maps directions
 */

export interface Props {
	title: string;
	subtitle: string;
	description: string;
	mapTitle: string;
	getDirectionsText: string;
	getDirectionsUrl: string;
	class?: string;
}

const { title, subtitle, description, mapTitle, getDirectionsText, getDirectionsUrl, class: className } = Astro.props;
---

<section id="overview" class:list={["section", className]}>
	<div class="container-custom">
		<div class="section-header">
			<h2 class="section-title">{title}</h2>
			<p class="section-subtitle">{subtitle}</p>
		</div>

		<div class="grid md:grid-cols-2 gap-8 lg:gap-12 mt-12">
			<!-- Left Column: Description -->
			<div class="flex flex-col justify-center">
				<p class="text-lg leading-relaxed text-[var(--color-text)]">{description}</p>
			</div>

			<!-- Right Column: Map -->
			<div class="flex flex-col">
				<h3 class="text-2xl font-serif font-bold text-[var(--color-text)] mb-6">{mapTitle}</h3>
				
				<!-- OpenStreetMap with Leaflet -->
				<div id="overview-map" class="w-full h-[400px] rounded-xl shadow-lg mb-4"></div>

				<!-- Get Directions Link -->
				<a 
					href={getDirectionsUrl}
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center gap-2 text-[var(--color-primary-600)] hover:text-[var(--color-primary-700)] font-medium transition-colors"
				>
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
					</svg>
					{getDirectionsText}
				</a>
			</div>
		</div>
	</div>
</section>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

<!-- Leaflet JS -->
<script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script is:inline>
	document.addEventListener('DOMContentLoaded', function() {
		const saintRuffinoCoords = [42.965, 13.357];
		const map = L.map('overview-map', {
			scrollWheelZoom: false, // Disable scroll wheel zoom by default
			touchZoom: true, // Keep pinch zoom enabled (2 fingers on mobile)
		}).setView([42.5, 12.5], 6);
		
		// Enable scroll zoom only with CTRL key
		map.on('wheel', function(e) {
			if (e.originalEvent.ctrlKey) {
				e.originalEvent.preventDefault();
				map.scrollWheelZoom.enable();
			} else {
				map.scrollWheelZoom.disable();
			}
		});
		
		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
			maxZoom: 19
		}).addTo(map);
		
		const markerIcon = L.divIcon({
			className: '',
			html: '<div class="w-10 h-10 -mt-10 -ml-5"><svg viewBox="0 0 24 24" fill="#8B4513" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5" fill="white"/></svg></div>',
			iconSize: [40, 40]
		});
		
		L.marker(saintRuffinoCoords, { icon: markerIcon })
			.addTo(map)
			.bindPopup('<div class="font-sans"><strong>San Ruffino</strong><br>Amandola, Marche, Italy</div>')
			.openPopup();
		
		L.circle(saintRuffinoCoords, {
			color: '#8B4513',
			fillColor: '#8B4513',
			fillOpacity: 0.2,
			radius: 5000
		}).addTo(map);
	});
</script>
