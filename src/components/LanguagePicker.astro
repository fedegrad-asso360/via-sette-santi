---
import { languages } from "../i18n/languages";

const base = import.meta.env.BASE_URL;
const pathname = Astro.url.pathname || '/';

const pathFor = (targetLang: string) => {
    // Remove base URL from pathname
    let pathWithoutBase = pathname;
    if (base !== '/' && pathname.startsWith(base)) {
        pathWithoutBase = pathname.slice(base.length);
    }
    
    // Remove leading slashes and split into segments
    const segments = pathWithoutBase.replace(/^\/+/, '').split('/').filter(Boolean);
    
    // Remove the current language (first segment) and keep the rest
    const rest = segments.slice(1);
    
    // Reconstruct path: base + targetLang + rest
    const newPath = [base, targetLang, ...rest].join('/').replace(/\/+/g, '/');
    
    // Ensure it starts with / and ends with / for consistency
    return newPath.startsWith('/') ? newPath : '/' + newPath;
};
---
<ul>
  {Object.entries(languages).map(([lang, label]) => (
    <li>
      <a href={pathFor(lang)}>{label}</a>
    </li>
  ))}
</ul>