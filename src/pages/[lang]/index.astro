---
// Main index homepage (language-specific)

import { getCollection } from "astro:content";
import { languages } from "../../i18n/languages";
import { useTranslations } from "../../i18n/utils";
import BaseLayout from "../../layouts/Base.astro";
import HeroCarousel from "../../components/HeroCarousel.astro";
import OverviewSection from "../../components/OverviewSection.astro";
import TrailsSection from "../../components/TrailsSection.astro";
import SaintsSection from "../../components/SaintsSection.astro";
import ReviewsSection from "../../components/ReviewsSection.astro";
import BookingSection from "../../components/BookingSection.astro";
import "../../styles/global.css";

export function getStaticPaths() {
	// converts languages object keys into an array of lang params
	return Object.keys(languages).map((lang) => ({
		params: { lang },
	}));
}

const { lang } = Astro.params;
const t = useTranslations(lang as keyof typeof languages);

// Get all trails for this language
const allTrails = await getCollection("trails", ({ id }) => {
	return id.startsWith(`${lang}/`);
});

// Get all saints for this language
const allSaints = await getCollection("saints", ({ id }) => {
	return id.startsWith(`${lang}/`);
});

// Sample reviews (in real app, these would come from a database or CMS)
const sampleReviews = [
	{
		name: "Marco Rossi",
		location: "Milano, Italy",
		rating: 5,
		date: "November 2024",
		text: lang === 'it' 
			? "Un'esperienza straordinaria! Il cammino offre paesaggi mozzafiato e un'atmosfera di profonda spiritualità. Le chiese sono tutte meravigliose."
			: "An extraordinary experience! The trail offers breathtaking landscapes and an atmosphere of deep spirituality. The churches are all wonderful."
	},
	{
		name: "Anna Weber",
		location: "Munich, Germany",
		rating: 5,
		date: "October 2024",
		text: lang === 'de'
			? "Eine wunderbare spirituelle Reise durch die Berge. Die Gastfreundschaft der Einheimischen und die Schönheit der Natur sind unvergesslich."
			: "A wonderful spiritual journey through the mountains. The hospitality of the locals and the beauty of nature are unforgettable."
	},
	{
		name: "Sarah Johnson",
		location: "London, UK",
		rating: 4,
		date: "September 2024",
		text: "Beautiful scenery and well-marked trails. The combination of nature and spirituality makes this trek unique. Highly recommended!"
	}
];

// Booking options
const bookingOptions = [
	{
		title: t('booking.individual'),
		description: t('booking.individualDesc'),
		features: [
			lang === 'it' ? 'Mappe e guida dettagliata' : lang === 'de' ? 'Karten und detaillierter Führer' : 'Maps and detailed guide',
			lang === 'it' ? 'Supporto telefonico 24/7' : lang === 'de' ? '24/7 telefonische Unterstützung' : '24/7 phone support',
			lang === 'it' ? 'Prenotazione alloggi' : lang === 'de' ? 'Unterkunftsbuchung' : 'Accommodation booking',
		]
	},
	{
		title: t('booking.group'),
		description: t('booking.groupDesc'),
		features: [
			lang === 'it' ? 'Guida locale esperta' : lang === 'de' ? 'Erfahrener lokaler Führer' : 'Expert local guide',
			lang === 'it' ? 'Gruppo max 12 persone' : lang === 'de' ? 'Gruppe max. 12 Personen' : 'Group max 12 people',
			lang === 'it' ? 'Visite guidate alle chiese' : lang === 'de' ? 'Geführte Kirchenbesichtigungen' : 'Guided church visits',
			lang === 'it' ? 'Assicurazione inclusa' : lang === 'de' ? 'Versicherung inbegriffen' : 'Insurance included',
		]
	},
	{
		title: t('booking.premium'),
		description: t('booking.premiumDesc'),
		features: [
			lang === 'it' ? 'Guida privata dedicata' : lang === 'de' ? 'Privater Führer' : 'Private dedicated guide',
			lang === 'it' ? 'Alloggi premium' : lang === 'de' ? 'Premium-Unterkunft' : 'Premium accommodations',
			lang === 'it' ? 'Tutti i pasti inclusi' : lang === 'de' ? 'Alle Mahlzeiten inklusive' : 'All meals included',
			lang === 'it' ? 'Transfer bagagli' : lang === 'de' ? 'Gepäcktransfer' : 'Luggage transfer',
			lang === 'it' ? 'Massaggio dopo trekking' : lang === 'de' ? 'Massage nach dem Wandern' : 'Post-trek massage',
		]
	}
];
---

<BaseLayout>
	<!-- Hero Carousel -->
	<HeroCarousel 
		title={t('hero.title')}
		subtitle={t('hero.subtitle')}
		ctaText={t('hero.cta')}
		ctaLink={`#overview`}
	/>

	<!-- Overview Section -->
	<div class="section-spacing-lg">
		<OverviewSection
			title={t('overview.title')}
			subtitle={t('overview.subtitle')}
			description={t('overview.description')}
			locationLabel={t('overview.location')}
			locationText={t('overview.locationText')}
		/>
	</div>

	<!-- Trails Section -->
	<div class="section-spacing-lg">
		<TrailsSection
			title={t('trails.title')}
			subtitle={t('trails.subtitle')}
			trails={allTrails}
			lang={lang}
			translations={{
				distance: t('trails.distance'),
				duration: t('trails.duration'),
				difficulty: t('trails.difficulty'),
				viewDetails: t('trails.viewDetails'),
				easy: t('trails.difficulty.easy'),
				moderate: t('trails.difficulty.moderate'),
				hard: t('trails.difficulty.hard')
			}}
		/>
	</div>

	<!-- Saints Section -->
	<div class="section-spacing-lg">
		<SaintsSection
			title={t('saints.title')}
			subtitle={t('saints.subtitle')}
			saints={allSaints}
			lang={lang}
			translations={{
				learnMore: t('saints.learnMore')
			}}
		/>
	</div>

	<!-- Reviews Section -->
	<div class="section-spacing-lg">
		<ReviewsSection
			title={t('reviews.title')}
			subtitle={t('reviews.subtitle')}
			reviews={sampleReviews}
		/>
	</div>

	<!-- Booking Section -->
	<section id="booking" class="section section-spacing-lg">
		<div class="container-custom">
			<BookingSection
				title={t('booking.title')}
				subtitle={t('booking.subtitle')}
				options={bookingOptions}
				contactText={t('booking.contactUs')}
				contactLink="#"
			/>
		</div>
	</section>
</BaseLayout>
